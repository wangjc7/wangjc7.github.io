<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="橙子's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="todoit.com.cn">
<meta property="og:type" content="website">
<meta property="og:title" content="橙子&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="橙子&#39;s Blog">
<meta property="og:description" content="todoit.com.cn">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="橙子&#39;s Blog">
<meta name="twitter:description" content="todoit.com.cn">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>橙子's Blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">橙子's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">挑战未知</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/19/Python正则表达式匹配反斜杠/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/19/Python正则表达式匹配反斜杠/" itemprop="url">Python正则表达式匹配反斜杠</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-19T00:44:29+08:00">
                2018-05-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Python正则式的过程中，有一个问题一直困扰我，如何去匹配一个反斜杠（即”\”）？</p>
<h1 id="一、普通字符串转义"><a href="#一、普通字符串转义" class="headerlink" title="一、普通字符串转义"></a>一、普通字符串转义</h1><p>反斜杠，在Python中比较特殊，就是它可以用来构成一些特殊字符，比如“\n”表示换行，“\t”表示制表符。下面是使用“\n”的一行代码：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> <span class="string">'Hello\World\nPython'</span></span><br></pre></td></tr></table></figure>
<p>结果为：<br>“Hello\World<br>Python“</p>
<p>可以看到其中的“\n”已转义为换行符，而“\W”没有发生转义，原因是“\W”在“字符串转义”中并不对应着特殊字符，没有特殊含义。</p>
<p>如果现在要求变了，要求不对“\n”转义为换行，而是原封不动输出为“Hello\World\nPython”，该怎么办呢？</p>
<p>1）可以这样写“Hello\World\\nPython”，这样输出的时候，“字符串转义”会把“\\”转义为“\”；</p>
<p>2）也可使用另一种方法：原始字符串；原始字符串（即r’…’）：字符串中所有字符都直接按照字面意思来使用，不转义特殊字符。</p>
<p>下面是使用原始字符串的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="string">r'Hello\World\nPython'</span></span><br></pre></td></tr></table></figure>
<p>结果为：<br>“Hello\World\nPython”<br>可以清楚看到，在使用原始字符串之后，“\n”未被转义为换行符，而是直接被输出了。</p>
<h1 id="二、正则转义"><a href="#二、正则转义" class="headerlink" title="二、正则转义"></a>二、正则转义</h1><p>好了，上面讲的只是“字符串转义”。同理，在正则表达式中也存在转义，我们姑且先称其为“正则转义”，其与“字符串转义”完全不同，比如“\d”代表数字，“\s”代表空白符。下面我们先编写开头的例子，然后再分析。</p>
<p>提取“3\8”反斜杠之前的数字：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python  </span></span><br><span class="line"><span class="comment">#coding=utf-8  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> re  </span><br><span class="line">  </span><br><span class="line">string = <span class="string">'3\8'</span>  </span><br><span class="line">m = re.search(<span class="string">'(\d+)\\\\'</span>, string)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> m <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:  </span><br><span class="line">    <span class="keyword">print</span> m.group(<span class="number">1</span>)  <span class="comment"># 结果为：3  </span></span><br><span class="line">  </span><br><span class="line">n = re.search(<span class="string">r'(\d+)\\'</span>, string)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> n <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:  </span><br><span class="line">    <span class="keyword">print</span> n.group(<span class="number">1</span>)  <span class="comment"># 结果为：3</span></span><br></pre></td></tr></table></figure>
<p>正则表达式字符串需要经过两次转义，这两次分别是上面的“字符串转义”和“正则转义”，个人认为“字符串转义”一定先于“正则转义”。</p>
<p>1）’\\‘的过程：<br>先进行“字符串转义”，前两个反斜杠和后两个反斜杠分别被转义成了一个反斜杠；即“\|\”被转成了“|\”（“|”为方便看清，请自动忽略）。“字符串转义”后马上进行“正则转义”，“\”被转义为了“\”，表示该正则式需要匹配一个反斜杠。</p>
<p>2）r’\‘的过程：<br>由于原始字符串中所有字符直接按照字面意思来使用，不转义特殊字符，故不做“字符串转义”，直接进入第二步“正则转义”，在正则转义中“\”被转义为了“\”，表示该正则式需要匹配一个反斜杠。</p>
<h1 id="三、结论"><a href="#三、结论" class="headerlink" title="三、结论"></a>三、结论</h1><p>也就是说原始字符串（即r’…’）与“正则转义”毫无关系，原始字符串仅在“字符串转义”中起作用，使字符串免去一次转义。</p>
<p>也许有哥们会问，为什么“\d+\\”中的“\d+”即使没用原始字符串，也没出现什么问题。那是因为在做“字符串转义”时，“\d”并不对应特殊字符，所以顺利的留到了“正则转义”时再处理，在“正则转义”中其表示数字。</p>
<p>参考自《Python核心编程》第二版，如有不恰当的地方，还望包容和指出，感谢。</p>
<p>转自：<a href="https://blog.csdn.net/jinixin/article/details/56705284" target="_blank" rel="noopener">https://blog.csdn.net/jinixin/article/details/56705284</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/17/Impala优化基本方案/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/17/Impala优化基本方案/" itemprop="url">Impala优化基本方案</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-17T00:30:12+08:00">
                2018-05-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/impala/" itemprop="url" rel="index">
                    <span itemprop="name">impala</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h1><p>本文源自cloudera官网上的Impala文档，原名为《Impala Performance Guidelines and Best Practices》。主要介绍了为了提升impala性能应该考虑的一些事情，这些条目算是对于性能提升最基本的约束了，条目分别如下：</p>
<ol>
<li>选择合适的文件存储格式，既然使用impala，无非就是为了一个目的：性能好/资源消耗少，Impala为了做到通用性，也就是为了更好的hive无缝连接，支持了大部分Hive支持的文件格式，例如Text、Avro、RCFile、Parquet等（不支持ORC），但是为了实现更快的ad-hoc查询（基本上都是OLAP查询，查询部分列，聚合，分析），我们基本上都会选择使用Parquet格式作为数据文件存储格式，即使你的数据导入到hive中存储的使用的是其它格式（甚至通过自定义serde解析，例如Json），仍然建议你新建一个Parquet格式的表，然后进行一次数据的转换。因此这个条目可以看做是：请选用Parquet作为文件存储格式！</li>
<li>选择合适的Partition粒度，分区的个数通常是根据业务数据来的，通常时间分区（例如日期/月份）是少不了的，例如对于一个支持多终端的应用，可能在时间分区下面再加一层终端类型的分区，设置对于每一个终端的不同操作在进行一层分区，根据唯物辩证法，凡事都需要保持一个度，那么就从两个极端的情况下来分析分区的粒度如何确定：1：分区过少:，整个表不使用分区，或者只有一个日期的分区，这样会导致频繁的查询某一个终端的数据不得不扫描整天的数据甚至整个表的数据，这是一种浪费；2、分区过多，对于每一个要统计的维度都创建一个分区，这样对于任何一个维度=’xxx’的查询都只需要扫描精确需要的数据，但是这样会导致大量的数据目录，进而导致大量的文件需要扫描，这对于查询优化器是一个灾难。因此最终的建议是：根据查询需求确定分区的粒度，根据每一个分区的成员个数预估总的分区数，保证一个表的分区数不超过30000（经验之谈？），避免过小的分区。</li>
<li>尽量分区的成员的长度，目前分区字段可以支持数值类型和字符串，但是这里推荐尽可能的使用合适的整数（一般用0-256就可以保存一个分区成员的映射了，否则分区会很多）而非原始的字符串，可以在外面建立字符串到整数的映射以保存原始信息，这个约束的主要原因是每一个分区会占用一个目录，每一个目录名又会在NameNode中占用一定的内存，所以不光光是对于Impala而言，对于使用Hadoop的用户而言，尽量减小文件目录的长度。</li>
<li>选择合适的Parquet Block大小，在条目1中已经明确，要使用Impala获得较快的查询性能，那么就老老实实的使用Parquet作为存储格式，而每一个Parquet的Block大小又有什么影响呢，这里暂且把Block的大小理解成一个Parquet分区的大小，在存储上表现为文件大小，如果文件过大，那么会导致这个文件只会一个Impalad进程处理，这样大大降低了Impala的并行处理能力；而如果文件过小则会导致大量的小文件，在带来并发执行的同时也会带来大量的随机I/O的影响，因此需要对于特定的数据进行不同的parquet Block大小测试以寻求最适合该数据集的Block大小。</li>
<li>收集表和分区的统计信息，在执行完数据导入之后，建议使用 COMPUTE STATS语句收集表的统计信息，当然也可以只收集某一个分区的统计信息。</li>
<li>减少返回结果大小，如果需要统计聚合，直接在SQL中完成，尽可能的在where中执行过滤而不要查出来之后在应用端做过滤，对于查询结果尽可能使用LIMIT限制返回结果集大小；避免大量的结果展示在终端，可以考虑通过INSERT xxx的方式把结果输出到文件，或者通过impala-shell参数将结果重定向。</li>
<li>对于执行性能较差的查询使用EXPLAIN分析原因。</li>
<li>最后，查询操作系统配置、查看系统使用负载，可以使用Query Profile工具来探测。</li>
</ol>
<p>上面的这些条目是最基本的应对性能调优的方案，主要包括：使用Parquet格式存储数据、分区粒度要确定好，保证整个表的分区数不要太多（目录不要太多），每一个分区下不要存在过多的小文件（选择合适的Parquet文件大小），收集统计信息使得查询优化器能够选择更好的查询方案，最后要学会使用EXPLAIN和Profile功能分析性能问题所在。</p>
<h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">[hadoop15:21000] &gt;  explain <span class="string">"此处sql省略"</span>，原SQL执行时间7'</span><br><span class="line">+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">|<span class="string"> Explain String                                                                                                                                                                                                                                                                                         </span>|</span><br><span class="line">+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">|<span class="string"> Estimated Per-Host Requirements: Memory=432.00MB VCores=3                                                                                                                                                                                                                                              </span>|</span><br><span class="line">|<span class="string"> WARNING: The following tables are missing relevant table and/or column statistics.                                                                                                                                                                                                                     </span>|</span><br><span class="line">|<span class="string"> db1.tab1, db2.tab2                                                                                                                                                                                                                                                              </span>|</span><br><span class="line">|<span class="string">                                                                                                                                                                                                                                                                                                        </span>|</span><br><span class="line">|<span class="string"> 26:EXCHANGE [UNPARTITIONED]                                                                                                                                                                                                                                                                            </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">                                                                                                                                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> 14:HASH JOIN [LEFT OUTER JOIN, PARTITIONED]                                                                                                                                                                                                                                                            </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">                                                                                                                                                                                                               </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">                                                                                                                                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">--25:EXCHANGE [HASH(to_date(...))]                                                                                                                                                                                                                                             </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  12:AGGREGATE [FINALIZE]                                                                                                                                                                                                                                                                             </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">  output: ...                                                                                                                                                                                                                                                                        </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">  group by: ...                                                                                                                                                                                                                                                    </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  24:AGGREGATE                                                                                                                                                                                                                                                                                        </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">  group by: ...                                                                                                                                                                                                                                        </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  23:EXCHANGE [HASH(...)]                                                                                                                                                                                                                                             </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  11:AGGREGATE [STREAMING]                                                                                                                                                                                                                                                                            </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">  group by: ...                                                                                                                                                                                                                                       </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  10:HASH JOIN [LEFT OUTER JOIN, PARTITIONED]                                                                                                                                                                                                                                                         </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">  hash predicates: ...                                                                                                                                                                                                                                                       </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">  other predicates: ... </span></span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">--22:EXCHANGE [HASH(...)]                                                                                                                                                                                                                                                                  </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">  09:SCAN HDFS [...]                                                                                                                                                                                                                                                            </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">     partitions=1/1 files=4 size=572.48MB                                                                                                                                                                                                                                                          </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">     predicates: ...                                                                                                                                            </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  21:EXCHANGE [HASH(...)]                                                                                                                                                                                                                                                                     </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  08:SCAN HDFS [...]                                                                                                                                                                                                                                                               </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">     partitions=2360/2360 files=2360 size=1.84GB                                                                                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">     predicates: ...                                                                                                                                                                                    </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">                                                                                                                                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> 13:HASH JOIN [RIGHT OUTER JOIN, PARTITIONED]                                                                                                                                                                                                                                                           </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  hash predicates: ...                                                                                                                                                                                                             </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">                                                                                                                                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">--02:AGGREGATE [FINALIZE]                                                                                                                                                                                                                                                                             </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">  output: ...                                                                                                                                                                                                                                                                          </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">  group by: ...                                                                                                                                                                                                                                                       </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  20:AGGREGATE                                                                                                                                                                                                                                                                                        </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">  group by: ...                                                                                                                                                                                                                                             </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  19:EXCHANGE [HASH(...)]                                                                                                                                                                                                                                                </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  01:AGGREGATE [STREAMING]                                                                                                                                                                                                                                                                            </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">  group by: ...                                                                                                                                                                                                                                             </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  00:SCAN HDFS [warehouse.mar_house]                                                                                                                                                                                                                                                                  </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">     partitions=1/1 files=4 size=572.48MB                                                                                                                                                                                                                                                             </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">     predicates: ...                                                                                                                                  </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">                                                                                                                                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> 07:AGGREGATE [FINALIZE]                                                                                                                                                                                                                                                                                </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> 18:AGGREGATE                                                                                                                                                                                                                                                                                           </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  group by: ...                                                                                                                                                                                                                                        </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">                                                                                                                                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> 17:EXCHANGE [HASH(...)]                                                                                                                                                                                                                                                </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">                                                                                                                                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> 06:AGGREGATE [STREAMING]                                                                                                                                                                                                                                                                               </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  group by: ...                                                                                                                                                                                                                                         </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">                                                                                                                                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> 05:HASH JOIN [LEFT OUTER JOIN, PARTITIONED]                                                                                                                                                                                                                                                            </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  hash predicates: ...                                                                                                                                                                                                                                                         </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  other predicates: ...    </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">                                                                                                                                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">--16:EXCHANGE [HASH(...)]                                                                                                                                                                                                                                                                     </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  </span>|<span class="string">                                                                                                                                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">  04:SCAN HDFS [warehouse.mar_house mh]                                                                                                                                                                                                                                                               </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">     partitions=1/1 files=4 size=572.48MB                                                                                                                                                                                                                                                             </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">     predicates: ...                                                                                                                                              </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">                                                                                                                                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> 15:EXCHANGE [HASH(...)]                                                                                                                                                                                                                                                                        </span>|</span><br><span class="line">|<span class="string"> </span>|<span class="string">                                                                                                                                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> 03:SCAN HDFS [...]                                                                                                                                                                                                                                                                  </span>|</span><br><span class="line">|<span class="string">    partitions=2360/2360 files=2360 size=1.84GB                                                                                                                                                                                                                                                         </span>|</span><br><span class="line">|<span class="string">    predicates: ...                                                                                                                                                                                         </span>|</span><br><span class="line">+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">Fetched 85 row(s) in 0.26s</span><br></pre></td></tr></table></figure>
<p>备注：由于sql为生产代码，不方便公开，仅适用示意代码，不影响表达主题<br>注意这行：</p>
<p>WARNING: The following tables are missing relevant table and/or column statistics.</p>
<p>db1.tab1, db2.tab2 </p>
<p>因此考虑对这两张表收集统计信息</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[hadoop15:21000] &gt; compute stats  db1.tab1;</span><br><span class="line">Query: compute stats  db1.tab1</span><br><span class="line"><span class="code">+-------------------------------------------+</span></span><br><span class="line">| summary                                   |</span><br><span class="line"><span class="code">+-------------------------------------------+</span></span><br><span class="line">| Updated 1 partition(s) and 100 column(s). |</span><br><span class="line"><span class="code">+-------------------------------------------+</span></span><br><span class="line">Fetched 1 row(s) in 4.87s</span><br><span class="line">[hadoop15:21000] &gt; compute stats db2.tab2;</span><br><span class="line">Query: compute stats db2.tab2</span><br><span class="line"><span class="code">+---------------------------------------------+</span></span><br><span class="line">| summary                                     |</span><br><span class="line"><span class="code">+---------------------------------------------+</span></span><br><span class="line">| Updated 2360 partition(s) and 96 column(s). |</span><br><span class="line"><span class="code">+---------------------------------------------+</span></span><br><span class="line">Fetched 1 row(s) in 148.34s</span><br><span class="line">[hadoop15:21000] &gt; </span><br><span class="line">[hadoop15:21000] &gt;  再次执行SQL</span><br><span class="line"><span class="code">+------------+</span>----------<span class="code">+-------------+</span>-----------<span class="code">+-------------+</span>----------结果集</span><br><span class="line"><span class="code">+------------+</span>----------<span class="code">+-------------+</span>-----------<span class="code">+-------------+</span>-----------+</span><br><span class="line">Fetched 10 row(s) in 0.94s</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/16/mapReduce-job-hangs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/16/mapReduce-job-hangs/" itemprop="url">mapReduce job hangs</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-16T11:56:17+08:00">
                2018-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">hadoop</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h1><p>I tried to run simple word count as MapReduce job，<br>but mapReduce job hangs, waiting for AM container to be allocated.</p>
<p>Output from job:</p>
<pre><code>*** START ***
15/12/25 17:52:50 INFO client.RMProxy: Connecting to ResourceManager at /0.0.0.0:8032
15/12/25 17:52:51 WARN mapreduce.JobResourceUploader: Hadoop command-line option parsing not performed. Implement the Tool interface and execute your application with ToolRunner to remedy this.
15/12/25 17:52:51 INFO input.FileInputFormat: Total input paths to process : 5
15/12/25 17:52:52 INFO mapreduce.JobSubmitter: number of splits:5
15/12/25 17:52:52 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1451083949804_0001
15/12/25 17:52:53 INFO impl.YarnClientImpl: Submitted application application_1451083949804_0001
15/12/25 17:52:53 INFO mapreduce.Job: The url to track the job: http://hadoop-droplet:8088/proxy/application_1451083949804_0001/
15/12/25 17:52:53 INFO mapreduce.Job: Running job: job_1451083949804_0001
</code></pre><p>YarnApplicationState:<br>ACCEPTED: waiting for AM container to be allocated,launched and register with RM.</p>
<p><img src="https://i.stack.imgur.com/rSXpb.png" alt="Mou icon"></p>
<h1 id="诊断"><a href="#诊断" class="headerlink" title="诊断"></a>诊断</h1><p>You should check the status of Node managers in your cluster. If the NM nodes are short on disk space then RM will mark them “unhealthy” and those NMs can’t allocate new containers.</p>
<p>1) Check the Unhealthy nodes: http://&lt;active_RM&gt;:8088/cluster/nodes/unhealthy</p>
<p>If the “health report” tab says “local-dirs are bad” then it means you need to cleanup some disk space from these nodes.</p>
<p>2) Check the DFS dfs.data.dir property in hdfs-site.xml. It points the location on local file system where hdfs data is stored.</p>
<p>3) Login to those machines and use df -h &amp; hadoop fs - du -h commands to measure the space occupied.</p>
<p>4) Verify hadoop trash and delete it if it’s blocking you. hadoop fs -du -h /user/user_name/.Trash and hadoop fs -rm -r /user/user_name/.Trash/*</p>
<p>访问：<a href="http://yarn001:8088/cluster/nodes/unhealthy" target="_blank" rel="noopener">http://yarn001:8088/cluster/nodes/unhealthy</a></p>
<p>发现符合第一种情况，Healthy报告如下：</p>
<pre><code>1/1 local-dirs are bad: /tmp/hadoop-wang/nm-local-dir;
1/1 log-dirs are bad: /Users/wang/soft/hadoop-2.7.5/logs/userlogs 
</code></pre><p>关于该问题网上说最常见原因是由于节点上的磁盘使用率超出了max-disk-utilization-per-disk-percentage（默认为90.0%）。<br>wangdeMacBook-Pro:hadoop-2.7.5 wang$ df -h</p>
<pre><code>Filesystem      Size   Used  Avail Capacity   iused   ifree %iused  Mounted on
/dev/disk1     465Gi  446Gi   18Gi    97% 117017228 4822386   96%   /
</code></pre><p>磁盘使用率已经是79%，确实是这个原因，但是这个可能只是表面原因。可以通过增加磁盘利用率阈值来缓解问题：<br>在yarn-site.xml中填写：</p>
<pre><code>&lt;property&gt;
    &lt;name&gt;yarn.nodemanager.disk-health-checker.max-disk-utilization-per-disk-percentage&lt;/name&gt;
    &lt;value&gt;98.5&lt;/value&gt;
&lt;/property&gt;
</code></pre><p>但是增加阈值的方法治标不治本，迟早有一天会超过你设置的98.5%。<br>建议清理磁盘空间或扩容。<br>over.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/15/单链表反转-Java/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/15/单链表反转-Java/" itemprop="url">单链表反转(Java)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-15T23:52:04+08:00">
                2018-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="单链表反转-Java"><a href="#单链表反转-Java" class="headerlink" title="单链表反转(Java)"></a>单链表反转(Java)</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p><strong>单链表反转</strong>使用p、q、r三个指针配合工作，使得两个节点间的指向反向，同时用r记录剩下的链表。基本流程如下图所示：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5266042-f6c75291059014f6.jpg" alt=""></p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">public class ReverseList &#123;</span><br><span class="line">    public static <span class="keyword">Node</span> <span class="title">reverseList</span>(<span class="keyword">Node</span> <span class="title">head</span>) &#123;</span><br><span class="line">        <span class="keyword">Node</span> <span class="title">p</span> = new <span class="keyword">Node</span><span class="title">(0</span>);</span><br><span class="line">        <span class="keyword">Node</span> <span class="title">q</span> = new <span class="keyword">Node</span><span class="title">(0</span>);</span><br><span class="line">        <span class="keyword">Node</span> <span class="title">r</span> = new <span class="keyword">Node</span><span class="title">(0</span>);</span><br><span class="line">        p = head;</span><br><span class="line">        q = head.next;</span><br><span class="line">        p.next = null;</span><br><span class="line"></span><br><span class="line">        while (q != null) &#123;</span><br><span class="line">            r = q.next;</span><br><span class="line">            q.next = p;</span><br><span class="line">            p = q;</span><br><span class="line">            q = r;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        head = p;</span><br><span class="line"></span><br><span class="line">        return head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(<span class="keyword">String</span>[] args) &#123;</span><br><span class="line">        int count = <span class="number">9</span>;</span><br><span class="line">        <span class="keyword">Node</span> <span class="title">t</span> = new <span class="keyword">Node</span><span class="title">(1</span>);</span><br><span class="line">        <span class="keyword">Node</span> <span class="title">x</span> = t;</span><br><span class="line"></span><br><span class="line">        for (int i = <span class="number">2</span>; i <span class="tag">&lt;= count; i++) &#123;</span></span><br><span class="line"><span class="tag">            x = (x.next = new Node(i));</span></span><br><span class="line"><span class="tag">        &#125;</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        t = reverseList(t);</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        while (t != null) &#123;</span></span><br><span class="line"><span class="tag">            System.out.print(t.val + " ");</span></span><br><span class="line"><span class="tag">            t = t.next;</span></span><br><span class="line"><span class="tag">        &#125;</span></span><br><span class="line"><span class="tag">    &#125;</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    public static class Node &#123;</span></span><br><span class="line"><span class="tag">        int val;</span></span><br><span class="line"><span class="tag">        Node next;</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        Node(int v) &#123;</span></span><br><span class="line"><span class="tag">            val = v;</span></span><br><span class="line"><span class="tag">        &#125;</span></span><br><span class="line"><span class="tag">    &#125;</span></span><br><span class="line"><span class="tag">&#125;</span></span><br></pre></td></tr></table></figure>
<p>转载：<br><a href="http://www.jianshu.com/p/5043be2fc875" target="_blank" rel="noopener">http://www.jianshu.com/p/5043be2fc875</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="andrew.wang" />
          <p class="site-author-name" itemprop="name">andrew.wang</p>
           
              <p class="site-description motion-element" itemprop="description">todoit.com.cn</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">andrew.wang</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
