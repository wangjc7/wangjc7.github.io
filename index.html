<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="橙子's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="todoit.com.cn">
<meta property="og:type" content="website">
<meta property="og:title" content="橙子&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="橙子&#39;s Blog">
<meta property="og:description" content="todoit.com.cn">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="橙子&#39;s Blog">
<meta name="twitter:description" content="todoit.com.cn">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>橙子's Blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">橙子's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">挑战未知</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/18/superset安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/18/superset安装/" itemprop="url">superset安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-18T14:48:50+08:00">
                2018-09-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/superset/" itemprop="url" rel="index">
                    <span itemprop="name">superset</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="superset"><a href="#superset" class="headerlink" title="superset"></a>superset</h2><p>Superset 是 Airbnb 开源的数据分析与可视化平台，同时也是由 Python 语言构建的轻量级 BI 系统。Superset 可实现对 TB 量级数据进行处理，兼容常见的数十种关系或非关系型数据库，并在内部实现 SQL 编辑查询等操作。除此之外，基于 Web 服务的 Superset 可实现多用户协使用，并可针对不同角色进行权限管理。</p>
<h2 id="Install-for-linux"><a href="#Install-for-linux" class="headerlink" title="Install(for linux):"></a>Install(for linux):</h2><pre><code>1.安装pip
2.安装virtualenv
3.安装mysqlclient,impyla,python-ldap,redis
4.安装superset
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple superset==0.22.1
5.修改config.py配置文件，修改元数据存储为Mysql
SQLALCHEMY_DATABASE_URI = &apos;mysql://username:password@ip/dbname?charset=utf8&apos;
6.创建管理员用户和密码
fabmanager create-admin --app superset
7.初始化数据
superset db upgrade
8.创建默认角色和权限
superset init
9.启动：
superset runserver -p 8388 -d   # -d为debug模式启动
10.访问：
http://ip:8388     admin/admin
</code></pre><p>superser主页：<br><a href="https://github.com/apache/incubator-superset" target="_blank" rel="noopener">https://github.com/apache/incubator-superset</a>    </p>
<p>—end—</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/Python-MySql语句插入中内容同时包含单引号和双引号的解决办法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/Python-MySql语句插入中内容同时包含单引号和双引号的解决办法/" itemprop="url">Python_MySql语句插入中内容同时包含单引号和双引号的解决办法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-16T22:07:11+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在python中调用MySQLdb模块插入数据信息，假设待输入信息data为：Hello’World”!</p>
<p>其中同时包含了单引号和双引号</p>
<p>一般插入语句为</p>
<pre><code>sql = &quot;insert into tb (my_str) values(&apos;%s&apos;)&quot; % (data)
cursor.execute(sql)
</code></pre><p>其中values(‘%s’)中的%s外面也要有引号，这个引号与data中的引号匹配导致了内容错误</p>
<p><strong>解决办法一:</strong></p>
<p>MySQLdb.escape_string()</p>
<p>在MySQLdb模块中自带针对mysql的转义函数escape_string()，直接调用即可</p>
<pre><code>sql = &quot;insert into tb (my_str) values(&apos;%s&apos;)&quot; % (MySQLdb.escape_string(data))
cursor.execute(sql)
</code></pre><p><strong>解决办法二</strong></p>
<p>cursor.execute()</p>
<p>cursor.execute()可以接受一个参数，也可以接受两个参数：</p>
<pre><code>cursor.execute(&quot;insert into tablename(c1,c2) values(%s, %s)&quot; , (value1,value2) );
</code></pre><p>这种格式是接受两个参数，MySQLdb会自动替你对字符串进行转义和加引号，不必再自己进行转义</p>
<p>实例：</p>
<pre><code>#-*-coding: utf8 -*-
from connectdb 
import connectDatabase; #connectDatabase是我自己定义的一个连接数据的函数
import MySQLdb;
def escape():
    cnn = connectDatabase();
    cursor = cnn.cursor();
    name = &quot;\\&quot;; 
    name2 = &quot;\&quot;&quot;
    print name,name2;
    queryli = [(12,name),(12,name2)]
    print queryli;
    #cursor.executemany(&quot;insert into resource(cid,name) values(%s, %s)&quot;,queryli);
    #接受两个参数，MySQLdb会自动替你对字符串进行转义和加引号，不必再自己进行转义
    #执行完此语句之后，resource表中多了一条记录： 12   \
    #但如果这么写，cursor.execute(&quot;insert into resource(cid,name) values(%s, %s)&quot; % (12,name) );
    #这种格式是利用python的字符串格式化自己生成一个query，也就是传给execute一个参数，
    #此时必须自己对字符串转义和增加引号，即上边的语句是错误的，应该修改为：
    #name = MySQLdb.escape_string(name);
    #cursor.execute(&quot;insert into resource(cid,name) values(%s, &apos;%s&apos;)&quot; % (12,name) );
    #这样插入的记录才和(1)一样：12   \
    cursor.execute(&quot;insert into resource(cid,name) values(%s, %s)&quot; , (12,name) );
    cursor.close(); 
    cnn.commit();
    cnn.close();

if __name__ == &quot;__main__&quot;:
    escape();
</code></pre><p><strong>解决办法三</strong></p>
<p>当然也可以自己转义字符</p>
<p>将data变为下面的形式,再插入数据库就正确了<br>Hello\’World\”!</p>
<p>具体在python中的转义函数如下：</p>
<pre><code>def transferContent(self, content):
        if content is None:
            return None
        else:
            string = &quot;&quot;
            for c in content:
                if c == &apos;&quot;&apos;:
                    string += &apos;\\\&quot;&apos;
                elif c == &quot;&apos;&quot;:
                    string += &quot;\\\&apos;&quot;
                elif c == &quot;\\&quot;:
                    string += &quot;\\\\&quot;
                else:
                    string += c
            return string
</code></pre><p>—end—</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/Windows与Linux回车换行符/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/Windows与Linux回车换行符/" itemprop="url">Windows与Linux回车换行符</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-16T21:25:23+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="回车、换行的区别"><a href="#回车、换行的区别" class="headerlink" title="回车、换行的区别"></a>回车、换行的区别</h3><p>回车”（Carriage Return）和“换行”（Line Feed）</p>
<pre><code>符号        ASCII码        意义

\n          10            换行

\r          13            回车CR
</code></pre><p>‘\r’ 回车，回到当前行的行首，而不会换到下一行，如果接着输出的话，本行以前的内容会被逐一覆盖；</p>
<p>‘\n’ 换行，换到当前位置的下一行，而不会回到行首；</p>
<p>Unix系统里，每行结尾只有“&lt;换行&gt;”，即”\n”；<br>Windows系统里面，每行结尾是“&lt;回车&gt;&lt;换行&gt;”，即“\r\n”；<br>Mac系统里，每行结尾是“&lt;回车&gt;”，即”\r”；。</p>
<p>一个直接后果是，Unix/Mac系统下的文件在Windows里打开的话，所有文字会变成一行；而Windows里的文件在Unix/Mac下打开的话，在每行的结尾可能会多出一个^M符号。</p>
<p>—end—</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/13/python发送邮件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/13/python发送邮件/" itemprop="url">python发送邮件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-13T19:16:23+08:00">
                2018-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>代码</strong>：</p>
<p>emailhelper.py</p>
<pre><code># -*- coding: UTF-8 -*-

import sys
import platform
import smtplib
from email.header import Header
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText

#  SMTP 服务
mail_host = &quot;smtp.company.com&quot;  # 设置服务器
mail_user = &quot;username@company.com&quot;  # 用户名
mail_pass = &quot;password&quot;  # 口令


def send_mail( receivers, subject, content, filenames=None):
    &quot;&quot;&quot;
    :param sender:string
    :param receivers:list[string]  # 如果收件人为多个格式[&apos;xx@a.com&apos;,&apos;yy@b.com&apos;]
    subject：string
    content: string
    filename: string
    :return:
    &quot;&quot;&quot;
    sender=mail_user
    filenames = [] if filenames is None else filenames  #附件名称
    try:
        message = MIMEMultipart()
        message.attach(MIMEText(content, &apos;plain&apos;, &apos;utf-8&apos;))
        message[&apos;Subject&apos;] = Header(subject, &apos;utf-8&apos;)
        # message[&apos;to&apos;]格式为：xx@aa.com, yy@bb.com
        message[&apos;to&apos;] = &apos;,&apos;.join(receivers)
        # 如果附件名称大于0个字符
        for filename in filenames:
            if filename is not None and len(filename.strip()) &gt; 0:
                att1 = MIMEText(open(filename, &apos;rb&apos;).read(), &apos;base64&apos;, &apos;utf-8&apos;)
                att1[&quot;Content-Type&quot;] = &apos;application/octet-stream&apos;
                # 这里的filename可以任意写，写什么名字，邮件中显示什么名字
                att1[&quot;Content-Disposition&quot;] = &apos;attachment; filename=&quot;%s&quot; filename
                    message.attach(att1)

        smtp_obj = smtplib.SMTP()
        smtp_obj.connect(mail_host, 25)  # 25 为 SMTP 端口号
        smtp_obj.login(mail_user, mail_pass)
        smtp_obj.sendmail(sender, receivers, message.as_string())
        smtp_obj.quit()
        print &quot;邮件发送成功&quot;
    except smtplib.SMTPException, e:
        print &quot;Error: 无法发送邮件,code:%s&quot; % e.smtp_code

    return
</code></pre><p>—over—</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/13/Hive分组取TopN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/13/Hive分组取TopN/" itemprop="url">Hive分组取TopN</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-13T16:03:56+08:00">
                2018-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hive/" itemprop="url" rel="index">
                    <span itemprop="name">hive</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Hive在0.11.0版本开始加入了row_number、rank、dense_rank分析函数，可以查询分组排序后的top值</p>
<h3 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h3><p>row_number() over ([partition col1] [order by col2])</p>
<p>rank() over ([partition col1] [order by col2])</p>
<p>dense_rank() over ([partition col1] [order by col2])</p>
<p>它们都是根据col1字段分组，然后对col2字段进行排序，对排序后的每行生成一个行号，这个行号从1开始递增<br>col1、col2都可以是多个字段，用’,’分隔</p>
<p><strong>区别</strong>：</p>
<ol>
<li><p>row_number：不管col2字段的值是否相等，行号一直递增，比如：有两条记录的值相等，但一个是第一，一个是第二</p>
</li>
<li><p>rank：上下两条记录的col2相等时，记录的行号是一样的，但下一个col2值的行号递增N（N是重复的次数），比如：有两条并列第一，下一个是第三，没有第二</p>
</li>
<li><p>dense_rank：上下两条记录的col2相等时，下一个col2值的行号递增1，比如：有两条并列第一，下一个是第二</p>
</li>
</ol>
<p><strong>row_number可以实现分页查询</strong></p>
<h3 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h3><pre><code>hive&gt; create table t(name string, sub string, score int) row format delimited fields terminated by &apos;\t&apos;;
</code></pre><p>数据在附件的a.txt里</p>
<pre><code>a chinese 98
a english 90
d chinese 88
c english 82
c math 98
b math 89
b chinese 79
z english 90
z math 89
z chinese 80
e math 99
e english 87
d english 90
</code></pre><p><strong>1. row_number</strong></p>
<pre><code>hive (test)&gt; select *, row_number() over (partition by sub order by score) as od from t; 
</code></pre><p><strong>2. rank</strong></p>
<pre><code>hive (test)&gt; select *, rank() over (partition by sub order by score) as od from t; 
</code></pre><p><strong>3. dense_ran</strong></p>
<pre><code>hive (test)&gt; select *, dense_rank() over (partition by sub order by score desc) from t;
</code></pre><p><strong>业务实例：</strong></p>
<p>统计每个学科的第一名</p>
<pre><code>select * from (select *, row_number() over (partition by sub order by score desc) as od from t ) t where od=1;
</code></pre><p>统计每个学科的前三名</p>
<pre><code>select * from (select *, row_number() over (partition by sub order by score desc) as od from t ) t where od&lt;=3;
</code></pre><p>语文成绩是80分的排名是多少</p>
<pre><code>hive (test)&gt; select od from (select *, row_number() over (partition by sub order by score desc) as od from t ) t where sub=&apos;chinese&apos; and score=80;
</code></pre><p>分页查询</p>
<pre><code>hive (test)&gt; select * from (select *, row_number() over () as rn from t) t1 where rn between 1 and 5;
</code></pre><p> 原文链接：</p>
<p> <a href="https://www.cnblogs.com/lishouguang/p/4560837.html" target="_blank" rel="noopener">https://www.cnblogs.com/lishouguang/p/4560837.html</a></p>
<p> —over—</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/13/CDH集群时钟偏差警报/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/13/CDH集群时钟偏差警报/" itemprop="url">CDH集群时钟偏差警报</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-13T15:24:32+08:00">
                2018-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/" itemprop="url" rel="index">
                    <span itemprop="name">CDH</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> CDH集群总是提示时钟偏差,但是查看ntpd服务是正常工作的. </p>
<p> OS Version:    CentOS Linux release 7.5.1804 (Core)</p>
<p> CDH Version:    CDH 5.8.4</p>
<p>于是google一下原理：</p>
<blockquote>
<p><strong>The clock NTP health check is executed by each agent running on nodes on your cluster.  The command executed is:</strong></p>
</blockquote>
<blockquote>
<p><strong>ntpdc -np</strong></p>
</blockquote>
<blockquote>
<p><strong>A timeout of 2 seconds is used, so if the ntp client does not return in 2 seconds, the health check will fail.</strong></p>
</blockquote>
<p>If there is a result, then the agent script will parse the result text and return a result metric that includes the clock offset.  this will be sent to the Host Monitor Management Service for processing.</p>
<p>You have 2 options here:  </p>
<p>If you are convinced there are no problems, you can turn off the Cloudera Manager Server Clock Offset Thresholds health check or adjust it as necessary in the Cloudera Manager management services.</p>
<p>Or, if you wish to troubleshoot, check the /var/log/cloudera-scm-agent/cloudera-scm-agent.log file for clues.<br>Search in that file for “ntpdc”.  If there are any errors running the command, a stack trace will be provided.</p>
<p>The agent merely parses the ntpdc output, so assuming your output looks something like this:</p>
<p>ntpdc -np</p>
<pre><code> remote           local      st poll reach  delay   offset    disp
=======================================================================
*132.163.4.101   10.17.81.194     1 1024  377 0.02972  0.001681 0.13664
=198.55.111.5    10.17.81.194     2 1024  377 0.01395  0.002177 0.13667
=50.116.55.65    10.17.81.194     2 1024  377 0.07263  0.001220 0.12172
</code></pre><p>The script will look for a line that starts with an “*” character.  So, in our example:</p>
<p>*132.163.4.101   10.17.81.194     1 1024  377 0.02972  0.001681 0.13664</p>
<p>Then, it will get the ‘offset’ column.<br>This value is returned to the Host Monitor which, will pull the metric and filter it through your health check configuration to decide if it warrants an alert.</p>
<p>Lastly, I’m not aware that anything has changed in the offset health check between CM 5.3 and 5.4, so I would recommend troubleshooting this to try to figure out why clock is offset.  Timing is important in hadoop, so it is worth a look.</p>
<p>参考链接：</p>
<p><a href="https://community.cloudera.com/t5/Cloudera-Manager-Installation/Cloudera-5-4-x-cluster-randomly-reports-quot-Clock-Offset-Bad/td-p/31166" target="_blank" rel="noopener">https://community.cloudera.com/t5/Cloudera-Manager-Installation/Cloudera-5-4-x-cluster-randomly-reports-quot-Clock-Offset-Bad/td-p/31166</a></p>
<p>—over—</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/25/PageRank算法介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/25/PageRank算法介绍/" itemprop="url">PageRank算法介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-25T22:50:16+08:00">
                2018-07-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h3><p>在PageRank发明之前，搜索引擎采用的还是最原始的关键字匹配技术，于是呢在搜索结果中经常会遇到「挂羊头卖狗肉」的垃圾网站，对这些网站，当时的Yahoo采用还是人工清理的方法。</p>
<p>这时候Google的两位创始人Page和Brin就在想，有没有一种算法，能够给出网页重要性的排序呢？这样就可以优先推荐重要网页，而让那些垃圾网页石沉大海了。Page和Brin发现，网页的超链接结构中就蕴含了重要程度的信息。由于一个网页的超链接指向的主要是与其内容相关的网页，那么我们不难想象，如果有许多网页都同时指向某一个网页，这个网页就一定非常重要。我们将互联网想象成一个流网络，网络的节点就是一个个网页，如果两个网页间存在超链接的关系，那么它们之间就存在一条有向的连边。想象存在一种货币，它们在这个流网络上随机地流动，在任意时刻，每个网页上都会有货币流入，也会有货币流出，当最终达到稳定时，将每个网页持有的货币存量，或者说「财富」的多寡由大到小排序，就得到了网页重要性的排序PageRank。</p>
<p>我们发现排在前面的主要是被较多引用的网页，当然有幸被重要网页引用的网页也会得到较大的PageRank值。当然我们还要考虑这样一种情况，如果遇到不引用任何其他网页的「铁公鸡」，或者网页A仅引用B，B仅引用C，C又仅引用A的「小团体」，货币只会流入不会流出，他们会积累大量的货币，但显然他们不一定是最重要的。为避免这样的情况发生，PageRank还使货币可以以概率e跳到系统中的任意其他节点。或者我们可以想象系统中存在一个「中央政府」，它在每一时刻都从各个网页节点的「财富」中征缴比例为e的「税金」，然后再平均分给每一个网页。</p>
<h3 id="链接："><a href="#链接：" class="headerlink" title="链接："></a>链接：</h3><p><a href="https://www.zhihu.com/question/19555545/answer/" target="_blank" rel="noopener">https://www.zhihu.com/question/19555545/answer/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/04/Error-found-before-invoking-supervisord-dictionary-update-sequence-element-100-has-length-1-2-is-required/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/04/Error-found-before-invoking-supervisord-dictionary-update-sequence-element-100-has-length-1-2-is-required/" itemprop="url">Error found before invoking supervisord: dictionary update sequence element #100 has length 1; 2 is required</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-04T17:36:07+08:00">
                2018-06-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/" itemprop="url" rel="index">
                    <span itemprop="name">CDH</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h1><p>cloudera manager agent bug report——can’t start tasktracker</p>
<p>cloudera manager 4.8 + CDH4.4 + centos5、6agent log below when start TT by CM</p>
<hr>
<p>[10/Feb/2014 09:08:44 +0000] 105652 MainThread util ERROR Failed to parse environment variables: CDH_HCAT_HOME=/usr/lib/hcatalog<br>HADOOP_LOGFILE=hadoop-cmf-mapreduce1-TASKTRACKER-dn3.hadoop.com.log.out<br>TOMCAT_HOME=/usr/lib/bigtop-tomcat<br>HOSTNAME=dn3.hadoop.com<br>HADOOP_SECURITY_LOGGER=INFO,RFAS<br>CDH_SOLR_HOME=/usr/lib/solr<br>CDH_PIG_HOME=/usr/lib/pig<br>HADOOP_LOG_DIR=/var/log/hadoop-0.20-mapreduce<br>CLOUDERA_MYSQL_CONNECTOR_JAR=/usr/share/java/mysql-connector-java.jar<br>SHELL=/bin/bash<br>TERM=linux<br>HISTSIZE=1000<br>SSH_CLIENT=61.135.207.195 50583 22<br>CDH_HUE_PLUGINS_HOME=/usr/lib/hadoop<br>CDH_HIVE_HOME=/usr/lib/hive<br>QTDIR=/usr/lib64/qt-3.3<br>QTINC=/usr/lib64/qt-3.3/include<br>SSH_TTY=/dev/pts/2<br>CLOUDERA_ORACLE_CONNECTOR_JAR=/usr/share/java/oracle-connector-java.jar<br>HIVE_DEFAULT_XML=/etc/hive/conf.dist/hive-default.xml<br>CDH_VERSION=4<br>MGMT_HOME=/usr/share/cmf<br>CMF_CONF_DIR=/etc/cloudera-scm-agent<br>USER=root<br>JSVC_HOME=/usr/libexec/bigtop-utils<br>LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:<em>.tar=01;31:</em>.tgz=01;31:<em>.arj=01;31:</em>.taz=01;31:<em>.lzh=01;31:</em>.lzma=01;31:<em>.tlz=01;31:</em>.txz=01;31:<em>.zip=01;31:</em>.z=01;31:<em>.Z=01;31:</em>.dz=01;31:<em>.gz=01;31:</em>.lz=01;31:<em>.xz=01;31:</em>.bz2=01;31:<em>.tbz=01;31:</em>.tbz2=01;31:<em>.bz=01;31:</em>.tz=01;31:<em>.deb=01;31:</em>.rpm=01;31:<em>.jar=01;31:</em>.rar=01;31:<em>.ace=01;31:</em>.zoo=01;31:<em>.cpio=01;31:</em>.7z=01;31:<em>.rz=01;31:</em>.jpg=01;35:<em>.jpeg=01;35:</em>.gif=01;35:<em>.bmp=01;35:</em>.pbm=01;35:<em>.pgm=01;35:</em>.ppm=01;35:<em>.tga=01;35:</em>.xbm=01;35:<em>.xpm=01;35:</em>.tif=01;35:<em>.tiff=01;35:</em>.png=01;35:<em>.svg=01;35:</em>.svgz=01;35:<em>.mng=01;35:</em>.pcx=01;35:<em>.mov=01;35:</em>.mpg=01;35:<em>.mpeg=01;35:</em>.m2v=01;35:<em>.mkv=01;35:</em>.ogm=01;35:<em>.mp4=01;35:</em>.m4v=01;35:<em>.mp4v=01;35:</em>.vob=01;35:<em>.qt=01;35:</em>.nuv=01;35:<em>.wmv=01;35:</em>.asf=01;35:<em>.rm=01;35:</em>.rmvb=01;35:<em>.flc=01;35:</em>.avi=01;35:<em>.fli=01;35:</em>.flv=01;35:<em>.gl=01;35:</em>.dl=01;35:<em>.xcf=01;35:</em>.xwd=01;35:<em>.yuv=01;35:</em>.cgm=01;35:<em>.emf=01;35:</em>.axv=01;35:<em>.anx=01;35:</em>.ogv=01;35:<em>.ogx=01;35:</em>.aac=01;36:<em>.au=01;36:</em>.flac=01;36:<em>.mid=01;36:</em>.midi=01;36:<em>.mka=01;36:</em>.mp3=01;36:<em>.mpc=01;36:</em>.ogg=01;36:<em>.ra=01;36:</em>.wav=01;36:<em>.axa=01;36:</em>.oga=01;36:<em>.spx=01;36:</em>.xspf=01;36:<br>SSH_AUTH_SOCK=/tmp/ssh-REFP104132/agent.104132<br>CDH_IMPALA_HOME=/usr/lib/impala<br>CDH_HTTPFS_HOME=/usr/lib/hadoop-httpfs<br>CDH_MR2_HOME=/usr/lib/hadoop-mapreduce<br>CDH_MR1_HOME=/usr/lib/hadoop-0.20-mapreduce<br>CDH_HUE_HOME=/usr/share/hue<br>CM_STATUS_CODES=STATUS_NONE HDFS_DFS_DIR_NOT_EMPTY JOBTRACKER_IN_STANDBY_MODE<br>MAIL=/var/spool/mail/root<br>PATH=/sbin:/usr/sbin:/bin:/usr/bin:/usr/kerberos/bin<br>CONF_DIR=/var/run/cloudera-scm-agent/process/364-mapreduce-TASKTRACKER<br>PWD=/var/log/cloudera-scm-agent<br>LANG=zh_CN.UTF-8<br>KDE_IS_PRELINKED=1<br>CDH_HADOOP_HOME=/usr/lib/hadoop<br>MODULEPATH=/usr/share/Modules/modulefiles:/etc/modulefiles<br>LOADEDMODULES=<br>KDEDIRS=/usr<br>HADOOP_AUDIT_LOGGER=INFO,RFAAUDIT<br>CDH_SQOOP2_HOME=/usr/lib/sqoop2<br>HISTCONTROL=ignoredups<br>KRB5CCNAME=/tmp/krb5cc_cm_agent<br>CDH_HDFS_HOME=/usr/lib/hadoop-hdfs<br>CDH_HADOOP_BIN=/usr/bin/hadoop<br>SSH_ASKPASS=/usr/libexec/openssh/gnome-ssh-askpass<br>SHLVL=3<br>HOME=/root<br>CDH_OOZIE_HOME=/usr/lib/oozie<br>CDH_HBASE_INDEXER_HOME=/usr/lib/hbase-solr<br>CDH_FLUME_HOME=/usr/lib/flume-ng<br>LOGNAME=root<br>QTLIB=/usr/lib64/qt-3.3/lib<br>CVS_RSH=ssh<br>SSH_CONNECTION=61.135.207.195 50583 223.202.52.31 22<br>CDH_HBASE_HOME=/usr/lib/hbase<br>CDH_ZOOKEEPER_HOME=/usr/lib/zookeeper<br>MODULESHOME=/usr/share/Modules<br>CDH_YARN_HOME=/usr/lib/hadoop-yarn<br>LESSOPEN=|/usr/bin/lesspipe.sh %s<br>HADOOP_TASKTRACKER_OPTS=-Xms1073741824 -Xmx1073741824 -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:-CMSConcurrentMTEnabled -XX:CMSInitiatingOccupancyFraction=70 -XX:+CMSParallelRemarkEnabled -Dhadoop.event.appender=,EventCatcher -Dhadoop.security.logger=INFO,RFAS<br>HADOOP_ROOT_LOGGER=INFO,RFA<br>CMF_PACKAGE_DIR=/usr/lib64/cmf/service<br>CLOUDERA_POSTGRESQL_JDBC_JAR=/usr/share/cmf/lib/postgresql-9.0-801.jdbc4.jar<br>G_BROKEN_FILENAMES=1<br>HISTTIMEFORMAT=%F %T<br>module=() { eval `/usr/bin/modulecmd bash $*`<br>}<br>_=/bin/env<br>Traceback (most recent call last):<br>File “/usr/lib64/cmf/agent/src/cmf/util.py”, line 286, in source<br>return dict((line.split(“=”, 1) for line in data.splitlines()))<br>ValueError: dictionary update sequence element #71 has length 1; 2 is required<br>[10/Feb/2014 09:08:44 +0000] 105652 MainThread agent ERROR Failed to activate {u’status_links’: {u’status’: u’<a href="http://dn3.hadoop.com:50060/&#39;}" target="_blank" rel="noopener">http://dn3.hadoop.com:50060/&#39;}</a>, u’name’: u’mapreduce-TASKTRACKER’, u’config_generation’: 5, u’configuration_data’: ‘PK</p>
<p>…(省略)</p>
<p>u’refresh_files’: [], u’user’: u’mapred’, u’auto_restart’: True, u’run_generation’: 1, u’parcels’: {}, u’environment’: {u’HADOOP_AUDIT_LOGGER’: u’INFO,RFAAUDIT’, u’HADOOP_TASKTRACKER_OPTS’: u’-Xms1073741824 -Xmx1073741824 -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:-CMSConcurrentMTEnabled -XX:CMSInitiatingOccupancyFraction=70 -XX:+CMSParallelRemarkEnabled -Dhadoop.event.appender=,EventCatcher -Dhadoop.security.logger=INFO,RFAS’, u’HADOOP_SECURITY_LOGGER’: u’INFO,RFAS’, u’HADOOP_LOG_DIR’: u’/var/log/hadoop-0.20-mapreduce’, u’HADOOP_ROOT_LOGGER’: u’INFO,RFA’, u’HADOOP_LOGFILE’: u’hadoop-cmf-mapreduce1-TASKTRACKER-dn3.hadoop.com.log.out’, u’CDH_VERSION’: u’4’}, u’optional_tags’: [u’cdh-plugin’, u’mapreduce-plugin’], u’running’: True, u’program’: u’mapreduce/mapreduce.sh’, u’required_tags’: [u’cdh’], u’arguments’: [u’tasktracker’], u’special_file_info’: [{u’permissions’: 420, u’deploy_dir’: u’$CDH_MR1_HOME/conf’, u’group’: u’root’, u’name’: u’taskcontroller.cfg’, u’user’: u’root’}], u’group’: u’hadoop’, u’id’: 364, u’resources’: [{u’file’: None, u’tcp_listen’: None, u’dynamic’: True, u’io’: None, u’memory’: None, u’directory’: None, u’cpu’: {u’shares’: 1024}}, {u’file’: None, u’tcp_listen’: None, u’dynamic’: True, u’io’: {u’weight’: 500}, u’memory’: None, u’directory’: None, u’cpu’: None}, {u’file’: None, u’tcp_listen’: None, u’dynamic’: False, u’io’: None, u’memory’: {u’hard_limit’: -1, u’soft_limit’: -1}, u’directory’: None, u’cpu’: None}, {u’file’: None, u’tcp_listen’: None, u’dynamic’: False, u’io’: None, u’memory’: None, u’directory’: {u’path’: u’/var/log/hadoop-0.20-mapreduce’, u’bytes_free_warning_threshhold_bytes’: 0, u’group’: u’hadoop’, u’user’: u’root’, u’mode’: 509}, u’cpu’: None}, {u’file’: None, u’tcp_listen’: None, u’dynamic’: False, u’io’: None, u’memory’: None, u’directory’: {u’path’: u’/var/lib/hadoop-mapreduce’, u’bytes_free_warning_threshhold_bytes’: 0, u’group’: u’hadoop’, u’user’: u’mapred’, u’mode’: 493}, u’cpu’: None}, {u’file’: None, u’tcp_listen’: None, u’dynamic’: False, u’io’: None, u’memory’: None, u’directory’: {u’path’: u’/data2/mapred/local’, u’bytes_free_warning_threshhold_bytes’: 0, u’group’: u’hadoop’, u’user’: u’mapred’, u’mode’: 493}, u’cpu’: None}, {u’file’: None, u’tcp_listen’: None, u’dynamic’: False, u’io’: None, u’memory’: None, u’directory’: {u’path’: u’/data3/mapred/local’, u’bytes_free_warning_threshhold_bytes’: 0, u’group’: u’hadoop’, u’user’: u’mapred’, u’mode’: 493}, u’cpu’: None}, {u’file’: None, u’tcp_listen’: None, u’dynamic’: False, u’io’: None, u’memory’: None, u’directory’: {u’path’: u’/data4/mapred/local’, u’bytes_free_warning_threshhold_bytes’: 0, u’group’: u’hadoop’, u’user’: u’mapred’, u’mode’: 493}, u’cpu’: None}, {u’file’: None, u’tcp_listen’: None, u’dynamic’: False, u’io’: None, u’memory’: None, u’directory’: {u’path’: u’/data5/mapred/local’, u’bytes_free_warning_threshhold_bytes’: 0, u’group’: u’hadoop’, u’user’: u’mapred’, u’mode’: 493}, u’cpu’: None}, {u’file’: None, u’tcp_listen’: None, u’dynamic’: False, u’io’: None, u’memory’: None, u’directory’: {u’path’: u’/data6/mapred/local’, u’bytes_free_warning_threshhold_bytes’: 0, u’group’: u’hadoop’, u’user’: u’mapred’, u’mode’: 493}, u’cpu’: None}, {u’file’: None, u’tcp_listen’: {u’bind_address’: u’172.16.11.187’, u’port’: 50060}, u’dynamic’: False, u’io’: None, u’memory’: None, u’directory’: None, u’cpu’: None}], u’one_off’: False}<br>Traceback (most recent call last):<br>File “/usr/lib64/cmf/agent/src/cmf/agent.py”, line 1004, in handle_heartbeat_response<br>new_process.activate()<br>File “/usr/lib64/cmf/agent/src/cmf/agent.py”, line 1899, in activate<br>self.write_process_conf()<br>File “/usr/lib64/cmf/agent/src/cmf/agent.py”, line 1990, in write_process_conf<br>“source_parcel_environment”, env))<br>File “/usr/lib64/cmf/agent/src/cmf/util.py”, line 289, in source<br>raise e<br><strong><em>ValueError: dictionary update sequence element #71 has length 1; 2 is required</em></strong></p>
<p>==========================</p>
<p>when i run linux command ‘env’ ,i saw some line has no symbol ‘=’：</p>
<p>#env</p>
<p>…<br>module=() { eval `/usr/bin/modulecmd bash $*`<br>}        &lt;&lt;&lt;== look here<br>_=/bin/env</p>
<p>according to error log, i open agent file “/usr/lib64/cmf/agent/src/cmf/util.py “, line 271-289:</p>
<p>271 def source(path, command, caller_env):<br>272 “””<br>273 Source a shell script in a subprocess and extract its environment and return<br>274 it as a dict. For our specific purposes we need to support executing a command<br>275 after sourcing the script to correctly populate the environment.<br>276 “””<br>277 for k, v in caller_env.iteritems():<br>278 if v is None:<br>279 LOG.warn(“None environment value: %s=%s” % (k, v,))<br>280<br>281 pipe = subprocess.Popen([‘/bin/bash’, ‘-c’, “. %s; %s; env | grep =” % (path, command)],<br>282 stdout=subprocess.PIPE, env=caller_env)<br>283 data = pipe.communicate()[0]<br>284<br>285 try:<br>286     return dict((line.split(“=”, 1) for line in data.splitlines()))    &lt;&lt;&lt;&lt;&lt;=== look here<br>287 except Exception, e:<br>288     LOG.exception(“Failed to parse environment variables: “ + data)<br>289     raise e</p>
<p>line 286 split line by “=”, then add to dict. when the line not contans ‘=’, error would throws.</p>
<h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><p>fix it:</p>
<hr>
<p>change<br>281 pipe = subprocess.Popen([‘/bin/bash’, ‘-c’, “. %s; %s; env” % (path, command)],</p>
<p>to<br>281 pipe = subprocess.Popen([‘/bin/bash’, ‘-c’, “. %s; %s; env | grep =” % (path, command)],</p>
<p>then:<br>/etc/init.d/cloudera-scm-agent restart<br>open cloudera manager, start TT</p>
<p>The most likely reason this is occurring is because the Cloudera Manager agent was started by invoking the init.d script rather than using the service command</p>
<p>(BAD)</p>
<p>/etc/init.d/cloudera-scm-agent start<br>(GOOD)<br>service cloudera-scm-agent start</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://community.cloudera.com/t5/Cloudera-Manager-Installation/Can-t-start-the-tasktracker/td-p/20596" target="_blank" rel="noopener">http://community.cloudera.com/t5/Cloudera-Manager-Installation/Can-t-start-the-tasktracker/td-p/20596</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/25/hive-UDF整理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/25/hive-UDF整理/" itemprop="url">hive UDF整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-25T09:10:16+08:00">
                2018-05-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hive/" itemprop="url" rel="index">
                    <span itemprop="name">hive</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="转-Hive-UDF整理"><a href="#转-Hive-UDF整理" class="headerlink" title="[转]Hive UDF整理"></a>[转]Hive UDF整理</h1><h2 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h2><h3 id="字符串长度函数：length"><a href="#字符串长度函数：length" class="headerlink" title="##字符串长度函数：length"></a>##字符串长度函数：length</h3><pre><code>语法: length(string A)

返回值: int

说明：返回字符串A的长度

举例：

hive&gt; select length(‘abcedfg’) from dual;

7
</code></pre><h3 id="字符串反转函数：reverse"><a href="#字符串反转函数：reverse" class="headerlink" title="##字符串反转函数：reverse"></a>##字符串反转函数：reverse</h3><pre><code>语法: reverse(string A)

返回值: string

说明：返回字符串A的反转结果

举例：

hive&gt; select reverse(‘abcedfg’) from dual;

gfdecba
</code></pre><h3 id="字符串连接函数：concat"><a href="#字符串连接函数：concat" class="headerlink" title="##字符串连接函数：concat"></a>##字符串连接函数：concat</h3><pre><code>语法: concat(string A, string B…)

返回值: string

说明：返回输入字符串连接后的结果，支持任意个输入字符串

举例：

hive&gt; select concat(‘abc’,&apos;def’,&apos;gh’) from dual;

abcdefgh
</code></pre><h3 id="带分隔符字符串连接函数：concat-ws"><a href="#带分隔符字符串连接函数：concat-ws" class="headerlink" title="##带分隔符字符串连接函数：concat_ws"></a>##带分隔符字符串连接函数：concat_ws</h3><pre><code>语法: concat_ws(string SEP, string A, string B…)

返回值: string

说明：返回输入字符串连接后的结果，SEP表示各个字符串间的分隔符

举例：

hive&gt; select concat_ws(‘,’,&apos;abc’,&apos;def’,&apos;gh’) from dual;

abc,def,gh
</code></pre><h3 id="字符串截取函数：substr-substring"><a href="#字符串截取函数：substr-substring" class="headerlink" title="##字符串截取函数：substr,substring"></a>##字符串截取函数：substr,substring</h3><pre><code>语法: substr(string A, int start),substring(string A, int start)

返回值: string

说明：返回字符串A从start位置到结尾的字符串

举例：

hive&gt; select substr(‘abcde’,3) from dual;

cde

hive&gt; select substring(‘abcde’,3) from dual;

cde

hive&gt;  select substr(‘abcde’,-1) from dual;  （和ORACLE相同）

e
</code></pre><h3 id="字符串截取函数：substr-substring-1"><a href="#字符串截取函数：substr-substring-1" class="headerlink" title="##字符串截取函数：substr,substring"></a>##字符串截取函数：substr,substring</h3><pre><code>语法: substr(string A, int start, int len),substring(string A, int start, int len)

返回值: string

说明：返回字符串A从start位置开始，长度为len的字符串

举例：

hive&gt; select substr(‘abcde’,3,2) from dual;

cd

hive&gt; select substring(‘abcde’,3,2) from dual;

cd

hive&gt;select substring(‘abcde’,-2,2) from dual;

de
</code></pre><h3 id="字符串转大写函数：upper-ucase"><a href="#字符串转大写函数：upper-ucase" class="headerlink" title="##字符串转大写函数：upper,ucase"></a>##字符串转大写函数：upper,ucase</h3><pre><code>语法: upper(string A) ucase(string A)

返回值: string

说明：返回字符串A的大写格式

举例：

hive&gt; select upper(‘abSEd’) from dual;

ABSED

hive&gt; select ucase(‘abSEd’) from dual;

ABSED
</code></pre><h3 id="字符串转小写函数：lower-lcase"><a href="#字符串转小写函数：lower-lcase" class="headerlink" title="##字符串转小写函数：lower,lcase"></a>##字符串转小写函数：lower,lcase</h3><pre><code>语法: lower(string A) lcase(string A)

返回值: string

说明：返回字符串A的小写格式

举例：

hive&gt; select lower(‘abSEd’) from dual;

absed

hive&gt; select lcase(‘abSEd’) from dual;

absed
</code></pre><h3 id="去空格函数：trim"><a href="#去空格函数：trim" class="headerlink" title="##去空格函数：trim"></a>##去空格函数：trim</h3><pre><code>语法: trim(string A)

返回值: string

说明：去除字符串两边的空格

举例：

hive&gt; select trim(‘ abc ‘) from dual;

abc
</code></pre><h3 id="左边去空格函数：ltrim"><a href="#左边去空格函数：ltrim" class="headerlink" title="##左边去空格函数：ltrim"></a>##左边去空格函数：ltrim</h3><pre><code>语法: ltrim(string A)

返回值: string

说明：去除字符串左边的空格

举例：

hive&gt; select ltrim(‘ abc ‘) from dual;

abc
</code></pre><h3 id="右边去空格函数：rtrim"><a href="#右边去空格函数：rtrim" class="headerlink" title="##右边去空格函数：rtrim"></a>##右边去空格函数：rtrim</h3><pre><code>语法: rtrim(string A)

返回值: string

说明：去除字符串右边的空格

举例：

hive&gt; select rtrim(‘ abc ‘) from dual;

abc
</code></pre><h3 id="正则表达式替换函数：regexp-replace"><a href="#正则表达式替换函数：regexp-replace" class="headerlink" title="##正则表达式替换函数：regexp_replace"></a>##正则表达式替换函数：regexp_replace</h3><pre><code>语法: regexp_replace(string A, string B, string C)

返回值: string

说明：将字符串A中的符合java正则表达式B的部分替换为C。注意，在有些情况下要使用转义字符

举例：

hive&gt; select regexp_replace(‘foobar’, ‘oo|ar’, ”) from dual;

fb
</code></pre><h3 id="正则表达式解析函数：regexp-extract"><a href="#正则表达式解析函数：regexp-extract" class="headerlink" title="##正则表达式解析函数：regexp_extract"></a>##正则表达式解析函数：regexp_extract</h3><pre><code>语法: regexp_extract(string subject, string pattern, int index)

返回值: string

说明：将字符串subject按照pattern正则表达式的规则拆分，返回index指定的字符。注意，在有些情况下要使用转义字符

举例：

hive&gt; select regexp_extract(‘foothebar’, ‘foo(.*?)(bar)’, 1) from dual;

the

hive&gt; select regexp_extract(‘foothebar’, ‘foo(.*?)(bar)’, 2) from dual;

bar

hive&gt; select regexp_extract(‘foothebar’, ‘foo(.*?)(bar)’, 0) from dual;

foothebar
</code></pre><h3 id="URL解析函数：parse-url"><a href="#URL解析函数：parse-url" class="headerlink" title="##URL解析函数：parse_url"></a>##URL解析函数：parse_url</h3><pre><code>语法: parse_url(string urlString, string partToExtract [, string keyToExtract])

返回值: string

说明：返回URL中指定的部分。partToExtract的有效值为：HOST, PATH, QUERY, REF, PROTOCOL, AUTHORITY, FILE, and USERINFO.

举例：

hive&gt; select parse_url(‘http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1′, ‘HOST’) from dual;

facebook.com

hive&gt; select parse_url(‘http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1′, ‘QUERY’, ‘k1′) from dual;

v1
</code></pre><h3 id="json解析函数：get-json-object"><a href="#json解析函数：get-json-object" class="headerlink" title="##json解析函数：get_json_object"></a>##json解析函数：get_json_object</h3><pre><code>语法: get_json_object(string json_string, string path)

返回值: string

说明：解析json的字符串json_string,返回path指定的内容。如果输入的json字符串无效，那么返回NULL。

举例：

hive&gt; select  get_json_object(&apos;{&quot;store&quot;:{&quot;fruit&quot;:[{&quot;weight&quot;:8,&quot;type&quot;:&quot;apple&quot;},{&quot;weight&quot;:9,&quot;type&quot;:&quot;pear&quot;}],&quot;bicycle&quot;:{&quot;price&quot;:19.95,&quot;color&quot;:&quot;red&quot;}},&quot;email&quot;:&quot;amy@only_for_json_udf_test.net&quot;,&quot;owner&quot;:&quot;amy&quot;}&apos;,&apos;$.owner&apos;) from dual;
amy
</code></pre><h3 id="空格字符串函数：space"><a href="#空格字符串函数：space" class="headerlink" title="##空格字符串函数：space"></a>##空格字符串函数：space</h3><pre><code>语法: space(int n)

返回值: string

说明：返回长度为n的字符串

举例：

hive&gt; select space(10) from dual;

hive&gt; select length(space(10)) from dual;

10
</code></pre><h3 id="重复字符串函数：repeat"><a href="#重复字符串函数：repeat" class="headerlink" title="##重复字符串函数：repeat"></a>##重复字符串函数：repeat</h3><pre><code>语法: repeat(string str, int n)

返回值: string

说明：返回重复n次后的str字符串

举例：

hive&gt; select repeat(‘abc’,5) from dual;

abcabcabcabcabc
</code></pre><h3 id="首字符ascii函数：ascii"><a href="#首字符ascii函数：ascii" class="headerlink" title="##首字符ascii函数：ascii"></a>##首字符ascii函数：ascii</h3><pre><code>语法: ascii(string str)

返回值: int

说明：返回字符串str第一个字符的ascii码

举例：

hive&gt; select ascii(‘abcde’) from dual;

97
</code></pre><h3 id="左补足函数：lpad"><a href="#左补足函数：lpad" class="headerlink" title="##左补足函数：lpad"></a>##左补足函数：lpad</h3><pre><code>语法: lpad(string str, int len, string pad)

返回值: string

说明：将str进行用pad进行左补足到len位

举例：

hive&gt; select lpad(‘abc’,10,’td’) from dual;

tdtdtdtabc

与GP，ORACLE不同，pad 不能默认
</code></pre><h3 id="右补足函数：rpad"><a href="#右补足函数：rpad" class="headerlink" title="##右补足函数：rpad"></a>##右补足函数：rpad</h3><pre><code>语法: rpad(string str, int len, string pad)

返回值: string

说明：将str进行用pad进行右补足到len位

举例：

hive&gt; select rpad(‘abc’,10,’td’) from dual;

abctdtdtdt
</code></pre><h3 id="分割字符串函数-split"><a href="#分割字符串函数-split" class="headerlink" title="##分割字符串函数: split"></a>##分割字符串函数: split</h3><pre><code>语法:  split(string str, string pat)

返回值:  array

说明: 按照pat字符串分割str，会返回分割后的字符串数组

举例：

hive&gt; select split(‘abtcdtef’,&apos;t’) from dual;

[&quot;ab&quot;,&quot;cd&quot;,&quot;ef&quot;]
</code></pre><h3 id="集合查找函数-find-in-set"><a href="#集合查找函数-find-in-set" class="headerlink" title="##集合查找函数: find_in_set"></a>##集合查找函数: find_in_set</h3><pre><code>语法: find_in_set(string str, string strList)

返回值: int

说明: 返回str在strlist第一次出现的位置，strlist是用逗号分割的字符串。如果没有找该str字符，则返回0（只能是逗号分隔，不然返回0）

举例：

hive&gt; select find_in_set(‘ab’,&apos;ef,ab,de’) from dual;

2

hive&gt; select find_in_set(‘at’,&apos;ef,ab,de’) from dual;

0
</code></pre><p><em>原文地址</em>：</p>
<p><a href="https://my.oschina.net/repine/blog/193867" target="_blank" rel="noopener">https://my.oschina.net/repine/blog/193867</a></p>
<p><a href="http://www.oratea.net/?p=951" target="_blank" rel="noopener">http://www.oratea.net/?p=951</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/19/Python正则表达式匹配反斜杠/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="andrew.wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="橙子's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/19/Python正则表达式匹配反斜杠/" itemprop="url">Python正则表达式匹配反斜杠</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-19T00:44:29+08:00">
                2018-05-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Python正则式的过程中，有一个问题一直困扰我，如何去匹配一个反斜杠（即”\”）？</p>
<h1 id="一、普通字符串转义"><a href="#一、普通字符串转义" class="headerlink" title="一、普通字符串转义"></a>一、普通字符串转义</h1><p>反斜杠，在Python中比较特殊，就是它可以用来构成一些特殊字符，比如“\n”表示换行，“\t”表示制表符。下面是使用“\n”的一行代码：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> <span class="string">'Hello\World\nPython'</span></span><br></pre></td></tr></table></figure>
<p>结果为：<br>“Hello\World<br>Python“</p>
<p>可以看到其中的“\n”已转义为换行符，而“\W”没有发生转义，原因是“\W”在“字符串转义”中并不对应着特殊字符，没有特殊含义。</p>
<p>如果现在要求变了，要求不对“\n”转义为换行，而是原封不动输出为“Hello\World\nPython”，该怎么办呢？</p>
<p>1）可以这样写“Hello\World\\nPython”，这样输出的时候，“字符串转义”会把“\\”转义为“\”；</p>
<p>2）也可使用另一种方法：原始字符串；原始字符串（即r’…’）：字符串中所有字符都直接按照字面意思来使用，不转义特殊字符。</p>
<p>下面是使用原始字符串的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="string">r'Hello\World\nPython'</span></span><br></pre></td></tr></table></figure>
<p>结果为：<br>“Hello\World\nPython”<br>可以清楚看到，在使用原始字符串之后，“\n”未被转义为换行符，而是直接被输出了。</p>
<h1 id="二、正则转义"><a href="#二、正则转义" class="headerlink" title="二、正则转义"></a>二、正则转义</h1><p>好了，上面讲的只是“字符串转义”。同理，在正则表达式中也存在转义，我们姑且先称其为“正则转义”，其与“字符串转义”完全不同，比如“\d”代表数字，“\s”代表空白符。下面我们先编写开头的例子，然后再分析。</p>
<p>提取“3\8”反斜杠之前的数字：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python  </span></span><br><span class="line"><span class="comment">#coding=utf-8  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> re  </span><br><span class="line">  </span><br><span class="line">string = <span class="string">'3\8'</span>  </span><br><span class="line">m = re.search(<span class="string">'(\d+)\\\\'</span>, string)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> m <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:  </span><br><span class="line">    <span class="keyword">print</span> m.group(<span class="number">1</span>)  <span class="comment"># 结果为：3  </span></span><br><span class="line">  </span><br><span class="line">n = re.search(<span class="string">r'(\d+)\\'</span>, string)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> n <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:  </span><br><span class="line">    <span class="keyword">print</span> n.group(<span class="number">1</span>)  <span class="comment"># 结果为：3</span></span><br></pre></td></tr></table></figure>
<p>正则表达式字符串需要经过两次转义，这两次分别是上面的“字符串转义”和“正则转义”，个人认为“字符串转义”一定先于“正则转义”。</p>
<p>1）’\\‘的过程：<br>先进行“字符串转义”，前两个反斜杠和后两个反斜杠分别被转义成了一个反斜杠；即“\|\”被转成了“|\”（“|”为方便看清，请自动忽略）。“字符串转义”后马上进行“正则转义”，“\”被转义为了“\”，表示该正则式需要匹配一个反斜杠。</p>
<p>2）r’\‘的过程：<br>由于原始字符串中所有字符直接按照字面意思来使用，不转义特殊字符，故不做“字符串转义”，直接进入第二步“正则转义”，在正则转义中“\”被转义为了“\”，表示该正则式需要匹配一个反斜杠。</p>
<h1 id="三、结论"><a href="#三、结论" class="headerlink" title="三、结论"></a>三、结论</h1><p>也就是说原始字符串（即r’…’）与“正则转义”毫无关系，原始字符串仅在“字符串转义”中起作用，使字符串免去一次转义。</p>
<p>也许有哥们会问，为什么“\d+\\”中的“\d+”即使没用原始字符串，也没出现什么问题。那是因为在做“字符串转义”时，“\d”并不对应特殊字符，所以顺利的留到了“正则转义”时再处理，在“正则转义”中其表示数字。</p>
<p>参考自《Python核心编程》第二版，如有不恰当的地方，还望包容和指出，感谢。</p>
<p>转自：<a href="https://blog.csdn.net/jinixin/article/details/56705284" target="_blank" rel="noopener">https://blog.csdn.net/jinixin/article/details/56705284</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="andrew.wang" />
          <p class="site-author-name" itemprop="name">andrew.wang</p>
           
              <p class="site-description motion-element" itemprop="description">todoit.com.cn</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">andrew.wang</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
